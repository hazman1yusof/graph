<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Flot Examples: Error Bars</title>
	<link href="asset/css/examples.css" rel="stylesheet" type="text/css">
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../../excanvas.min.js"></script><![endif]-->
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.js"></script>
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.flot.errorbars.js"></script>
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.flot.navigate.js"></script>
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.flot.crosshair.js"></script>
	<script language="javascript" type="text/javascript" src="asset/flot/jquery.flot.symbol.js"></script>
	<script language="javascript" type="text/javascript" src="asset/jquery.csv.min.js"></script>

	<style type="text/css">
		.sistole{color: blue}
		.distole{color: blue}
		.pulse{color: red}
		.temp{color: orange}
	</style>

	<script type="text/javascript">

	$(function() {

		var sistole=[],distole=[],pulse=[],temp=[],tick1=[],time=[];
		fetch('file.txt')
			.then(response => response.text())
			.then(function(data){
				var obj = $.csv.toObjects(data);
				var sis_dis =  obj.map(function(value,i){
					var diff = (parseFloat(value.sistole) - parseFloat(value.distole)) / 2;
					var center = parseFloat(value.sistole) - parseFloat(diff);
					return [i+1,center,diff];
				});
				var pulse = obj.map(function(value,i){
					return [i+1,value.pulse];
				});
				var temp = obj.map(function(value,i){
					return [i+1,value.temp];
				});
				var tick1 = obj.map(function(value,i){
					return [i+1,value.tick1];
				});
				var time = obj.map(function(value,i){
					return [i+1,value.time];
				});
				doPlot(temp.length+1,sis_dis,pulse,temp,tick1);
			});

		var plot;
		function doPlot(x,sis_dis,pulse,temp,tick1){
			var data_points = {
				//do not show points
				radius: 0,
				errorbars: "y", 
				yerr: {show:true, upperCap: drawArrow2, lowerCap: drawArrow, radius: 5, lineWidth: 2.5}
			};

			var data = [
				{color: "blue", lines: {show: false}, points: data_points, data: sis_dis, label: "Blood Pressure", yaxis: 1},
				{color: "red", lines: {show: true, lineWidth: 0.5}, points: {show:true}, data: pulse, label: "Pulse", yaxis: 1},
				{color: "orange", lines: {show: true, lineWidth: 1}, points: {show:true}, data: temp, label: "Temperature", yaxis: 2}
			];

			plot = $.plot($("#placeholder"), data , {
				legend: {position: "sw",show: true},
				crosshair: {mode: "x"},
				grid: {
					hoverable: true,
					autoHighlight: false
				},
				xaxes: [{
					min: 0,
					max: x,
					ticks: 20
				}],
				yaxes: [{
							min: 30,
							max: 180,
							ticks: 30
						},{
							// align if we are to the right
							min: -35,
							max: 60,
							ticks: 30,
							alignTicksWithAxis: 2,
							position: 'right'
						}],
			});

			plot2 = $.plot($("#placeholder2"),[{color: "black", points: {symbol:"cross",show:true}, data: tick1, label: "Best Motor Response"}],{
				legend: {show: false},
				xaxes: [{
					min: 0.5,
					max: x,
					ticks: ticktengah(x)
				}],
				yaxes: [{
					min: 0.5,
					max: 6.5,
					ticks: [[0.5,"<span class='yaxis'>flaccid</br></br></span>"],
							[1.5,"Extension</br></br>"],
							[2.5,"Abnormal Flexion</br></br>"],
							[3.5,"Flexor withdrawal</br></br>"],
							[4.5,"Localise pain</br></br>"],
							[5.5,"Obey commands</br></br>"],
							[6.5," </br></br>"]]
				}],
				grid: {hoverable:true}

			});
		}

		$("<div id='tooltip'></div>").css({
			"font-family": "Lato,Helvetica Neue,Arial,Helvetica,sans-serif",
			'font-size' : '0.9rem',
			'font-weight' : 'bold',
			'border-radius' : '.28571429rem',
			position: "absolute",
			display: "none",
			border: "2px solid #bababc",
			padding: "2px",
			"background-color": "#bababc",
			opacity: 0.70
		}).appendTo("body");

		function updateLegend() {
			updateLegendTimeout = null;

			var pos = latestPosition;

			var axes = plot.getAxes();
			if (pos.x < axes.xaxis.min || pos.x > axes.xaxis.max ||
				pos.y < axes.yaxis.min || pos.y > axes.yaxis.max) {
				return;
			}

			var i, j, arr = [], dataset = plot.getData();

			for (i = 0; i < dataset.length; ++i) {

				var series = dataset[i];

				// Find the nearest points, x-wise
				for (j = 1; j < series.data.length; ++j) {
					if (series.data[j][0] > pos.x + 1 ) {
						break;
					}
				}

				// Now Interpolate
				var y,
					p1 = series.data[j - 1],
					p2 = series.data[j];

				if (p1 == null) {
					y = p2;
				} else if (p2 == null) {
					y = p1;
				} else {
					y = p1;
				}
				arr[i] = y;

			}

			var sistole = parseFloat(arr[0][1]) + parseFloat(arr[0][2]),
				distole = parseFloat(arr[0][1]) -  parseFloat(arr[0][2]),
				pulse = arr[1][1];
				temp = arr[2][1];

			$("#tooltip").html("<b>Systole: </b><span class='sistole'>"+sistole
								+"</span><br/><b>Dystole: </b><span class='distole'>"+distole
								+"</span><br/><b>Pulse: </b><span class='pulse'>"+pulse
								+"</span><br/><b>Temperature: </b><span class='temp'>"+temp+"</span>")
					.css({top: pos.pageY+20, left: pos.pageX+20})
					.fadeIn(500);

		}

		var updateLegendTimeout = null;
		var latestPosition = null;
		$("#placeholder").bind("plothover",  function (event, pos, item) {
			latestPosition = pos;
			if (!updateLegendTimeout) {
				updateLegendTimeout = setTimeout(updateLegend, 50);
			}
		});

		$("#placeholder").mouseout(function() {
			$("#tooltip").hide();
		});

	});

	</script>
	<script language="javascript" type="text/javascript" src="util.js"></script>
</head>
<body>

	<div id="content">

		<div class="demo-container">
			<div id="placeholder" class="demo-placeholder" style="height: 60%"></div>
			<div id="placeholder2" class="demo-placeholder" style="height: 20%"></div>
		</div>

	</div>

</body>
</html>
